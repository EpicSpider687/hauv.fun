<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAO</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.9.179/pdf.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h1 { text-align: center; }
  .library { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
  .book { text-align: center; cursor: pointer; width: 120px; }
  .book img { width: 100px; height: 140px; display: block; margin: 0 auto 5px; }
  #viewer { display: none; text-align: center; margin-top: 20px; }
  canvas { border: 1px solid #ccc; }
  button { margin: 5px; padding: 5px 10px; }
</style>
</head>
<body>

<h1>SAO</h1>

<div class="library" id="library">
  <!-- Books will be added here -->
</div>

<div id="viewer">
  <h2 id="book-title"></h2>
  <canvas id="pdf-canvas"></canvas>
  <div>
    <button id="prev">Previous</button>
    <span>Page <span id="page-num"></span> / <span id="page-count"></span></span>
    <button id="next">Next</button>
  </div>
  <button id="back">Back to Library</button>
</div>

<script>
// === Define your books here ===
const books = [
  { title: "Book One", file: "Sword Art Online - Volume 1.pdf", icon: "SAO-V1-Icon.png" },
  { title: "Book Two", file: "book2.pdf", icon: "book2.png" }
];

const library = document.getElementById('library');
books.forEach((book, index) => {
  const div = document.createElement('div');
  div.className = 'book';
  div.innerHTML = `<img src="${book.icon}" alt="${book.title}"><span>${book.title}</span>`;
  div.addEventListener('click', () => openBook(index));
  library.appendChild(div);
});

// === PDF.js Setup ===
let pdfDoc = null, pageNum = 1, pageRendering = false, pageNumPending = null;
const scale = 1.5;
const canvas = document.getElementById('pdf-canvas');
const ctx = canvas.getContext('2d');

const viewer = document.getElementById('viewer');
const bookTitleEl = document.getElementById('book-title');
const pageNumEl = document.getElementById('page-num');
const pageCountEl = document.getElementById('page-count');
let currentBookIndex = null;

function renderPage(num) {
  pageRendering = true;
  pdfDoc.getPage(num).then((page) => {
    const viewport = page.getViewport({ scale: scale });
    canvas.height = viewport.height;
    canvas.width = viewport.width;

    const renderContext = { canvasContext: ctx, viewport: viewport };
    const renderTask = page.render(renderContext);

    renderTask.promise.then(() => {
      pageRendering = false;
      pageNumEl.textContent = num;
      localStorage.setItem(`book-${currentBookIndex}-page`, num);
      if (pageNumPending !== null) {
        renderPage(pageNumPending);
        pageNumPending = null;
      }
    });
  });
}

function queueRenderPage(num) {
  if (pageRendering) pageNumPending = num;
  else renderPage(num);
}

// === Navigation Buttons ===
document.getElementById('prev').addEventListener('click', () => {
  if (pageNum <= 1) return;
  pageNum--;
  queueRenderPage(pageNum);
});

document.getElementById('next').addEventListener('click', () => {
  if (pageNum >= pdfDoc.numPages) return;
  pageNum++;
  queueRenderPage(pageNum);
});

// === Back to Library ===
document.getElementById('back').addEventListener('click', () => {
  viewer.style.display = 'none';
  library.style.display = 'flex';
});

// === Open Book ===
function openBook(index) {
  currentBookIndex = index;
  const book = books[index];
  bookTitleEl.textContent = book.title;

  // Get last page if exists
  pageNum = parseInt(localStorage.getItem(`book-${index}-page`)) || 1;

  library.style.display = 'none';
  viewer.style.display = 'block';

  pdfjsLib.getDocument(book.file).promise.then((pdfDoc_) => {
    pdfDoc = pdfDoc_;
    pageCountEl.textContent = pdfDoc.numPages;
    renderPage(pageNum);
  });
}
</script>

</body>
</html>

